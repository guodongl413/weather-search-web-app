<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App Test</title>
</head>
<body>
    <h1>Weather App Test</h1>
    <form id="weatherForm">
        <label for="useCurrentLocation">
            <input type="checkbox" id="useCurrentLocation" name="useCurrentLocation">
            Use Current Location
        </label>
        <br><br>

        <label for="street">Street: </label>
        <input type="text" id="street" name="street">
        <br><br>

        <label for="city">City: </label>
        <input type="text" id="city" name="city">
        <br><br>

        <label for="state">State: </label>
        <input type="text" id="state" name="state">
        <br><br>

        <button type="button" onclick="getWeather()">Submit</button>
        <button type="button" onclick="clearForm()">Clear</button>
    </form>

    <h2>Weather Data:</h2>
    <div id="weatherCard"></div>

    <script src="./config.js" type="module"></script>
    <script type="module">
        import config from './config.js';

        function getWeather() {
            // 获取表单数据
            const useCurrentLocation = document.getElementById('useCurrentLocation').checked;
            const street = document.getElementById('street').value;
            const city = document.getElementById('city').value;
            const state = document.getElementById('state').value;

            // 构建请求 URL
            let url = `${config.API_BASE_URL}/get_location`;
            const params = new URLSearchParams();

            if (useCurrentLocation) {
                params.append('use_current_location', 'true');
            } else {
                if (street) params.append('street', street);
                if (city) params.append('city', city);
                if (state) params.append('state', state);
            }

            // 完整的 URL
            url += `?${params.toString()}`;

            // 发起请求
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // 提取当天的天气数据并显示在卡片上
                    const todayWeather = data.data.timelines[0].intervals[0].values;
                    const location = useCurrentLocation ? 'Current Location' : `${street}, ${city}, ${state}`;
                    displayWeatherCard(location, todayWeather);
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                    document.getElementById('weatherCard').innerHTML = `<p>Error: ${error.message}</p>`;
                });
        }

        function displayWeatherCard(location, weather) {
            // 创建卡片内容
            const cardContent = `
                <div>
                    <h3>Location: ${location}</h3>
                    <p><strong>Temperature:</strong> ${weather.temperature} °F</p>
                    <p><strong>Humidity:</strong> ${weather.humidity}%</p>
                    <p><strong>Pressure:</strong> ${weather.pressureSeaLevel} inHg <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-16-512.png" alt="Pressure Icon" width="20"></p>
                    <p><strong>Wind Speed:</strong> ${weather.windSpeed} mph <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-25-512.png" alt="Wind Speed Icon" width="20"></p>
                    <p><strong>Visibility:</strong> ${weather.visibility || 'N/A'} miles <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-30-512.png" alt="Visibility Icon" width="20"></p>
                    <p><strong>Cloud Cover:</strong> ${weather.cloudCover}% <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-28-512.png" alt="Cloud Cover Icon" width="20"></p>
                    <p><strong>UV Index:</strong> ${weather.uvIndex} <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-24-512.png" alt="UV Index Icon" width="20"></p>
                </div>
            `;

            // 将卡片内容放入 HTML 中
            document.getElementById('weatherCard').innerHTML = cardContent;
        }

        function clearForm() {
            // 清除表单中的所有输入和结果
            document.getElementById('useCurrentLocation').checked = false;
            document.getElementById('street').value = '';
            document.getElementById('city').value = '';
            document.getElementById('state').value = '';
            document.getElementById('weatherCard').innerHTML = '';
        }

        window.getWeather = getWeather;
        window.clearForm = clearForm;
    </script>
</body>
</html>
