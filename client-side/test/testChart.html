<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hourly Weather Chart Test</title>
    <!-- 引入 Highcharts 库 -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <style>
        /* 可选：图表容器的样式 */
        #hourlyWeatherChart {
            width: 100%;
            height: 600px;
            margin: 0 auto;
        }
    </style>
</head>
<body>

    <!-- 图表容器 -->
    <div id="hourlyWeatherChart"></div>

    <script>
        /**
         * 渲染逐小时天气图表
         * @param {Array} hourlyData - 小时级别的天气数据数组
         */
        function renderHourlyWeatherChart(hourlyData) {
            // 确保 hourlyData 是一个数组
            if (!Array.isArray(hourlyData)) {
                console.error('hourlyData 应该是一个包含间隔数据的数组。');
                return;
            }

            // 将数据转换为 [timestamp, value] 格式
            const temperatureSeries = hourlyData.map(data => [
                new Date(data.startTime).getTime(),
                data.values.temperature
            ]);
            const humiditySeries = hourlyData.map(data => [
                new Date(data.startTime).getTime(),
                data.values.humidity
            ]);
            const pressureSeries = hourlyData.map(data => [
                new Date(data.startTime).getTime(),
                data.values.pressureSeaLevel
            ]);

            Highcharts.chart('hourlyWeatherChart', {
                chart: {
                    zoomType: 'x'
                },
                title: {
                    text: 'Hourly Weather Forecast (Next 5 Days)'
                },
                xAxis: [{
                    type: 'datetime',
                    // 底部 x 轴：显示时间（6、12、18、00 点）
                    tickInterval: 6 * 3600 * 1000, // 每6小时一个刻度
                    labels: {
                        format: '{value:%H:%M}',
                        align: 'center'
                    },
                    title: { text: 'Time' },
                    gridLineWidth: 1,
                    // 放在底部
                    opposite: false
                }, {
                    type: 'datetime',
                    // 顶部 x 轴：显示日期，仅在00点时显示
                    linkedTo: 0, // 与底部 x 轴关联
                    tickInterval: 24 * 3600 * 1000, // 每天一个刻度
                    labels: {
                        format: '{value:%b %d}',
                        align: 'center',
                        rotation: 0,
                        style: {
                            color: 'black' // 将颜色设置为黑色
                        }
                    },
                    title: { text: 'Date' },
                    opposite: true,
                    gridLineWidth: 0
                }],
                yAxis: [{ // 温度 Y 轴（左侧）
                    title: { text: 'Temperature (°F)' },
                    min: 0, // 从 0°F 开始
                    max: 105,
                    tickPositioner: function () {
                        let positions = [];
                        for (let i = this.min; i <= this.max; i += 7) {
                            positions.push(i);
                        }
                        return positions;
                    },
                    opposite: false
                }, { // 湿度 Y 轴（右侧） - 隐藏刻度和标签
                    title: { text: 'Humidity (%)', enabled: false },
                    opposite: true,
                    labels: {
                        enabled: false // 隐藏标签
                    },
                    tickWidth: 0, // 隐藏刻度线
                    gridLineWidth: 0 // 可选：隐藏网格线
                }, { // 压力 Y 轴（右侧） - 显示刻度和标签
                    title: { text: 'Pressure (inHg)' },
                    opposite: true,
                    labels: {
                        format: '{value} inHg',
                        style: { color: 'green' }
                    },
                    tickInterval: 1, // 每 1 inHg 一个刻度
                    gridLineWidth: 0
                }],
                tooltip: {
                    shared: true,
                    xDateFormat: '%Y-%m-%d %H:%M',
                    valueDecimals: 2
                },
                series: [{
                    name: 'Temperature',
                    type: 'line',
                    data: temperatureSeries,
                    tooltip: { valueSuffix: ' °F' },
                    color: '#FF5733',
                    dashStyle: 'Solid',
                    marker: { enabled: false },
                    zIndex: 3,
                    yAxis: 0 // 分配给左侧温度 Y 轴
                }, {
                    name: 'Humidity',
                    type: 'column',
                    data: humiditySeries,
                    tooltip: { valueSuffix: ' %' },
                    yAxis: 1, // 分配给右侧湿度 Y 轴
                    color: '#33B5E5',
                    pointWidth: 8,
                    zIndex: 1
                }, {
                    name: 'Pressure',
                    type: 'line',
                    data: pressureSeries,
                    tooltip: { valueSuffix: ' inHg' },
                    yAxis: 2, // 分配给右侧压力 Y 轴
                    color: '#8BC34A',
                    dashStyle: 'ShortDash',
                    marker: { enabled: false },
                    zIndex: 2
                }],
                legend: {
                    // layout: 'vertical',
                    // align: 'right',
                    // verticalAlign: 'middle'
                    enabled: false
                },
                responsive: {
                    rules: [{
                        condition: {
                            maxWidth: 800
                        },
                        chartOptions: {
                            legend: {
                                layout: 'horizontal',
                                align: 'center',
                                verticalAlign: 'bottom'
                            }
                        }
                    }]
                }
            });
        }

        /**
         * 从 weatherData.json 加载数据并渲染图表
         */
        async function loadAndRenderChart() {
            try {
                const response = await fetch('weatherData.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! 状态: ${response.status}`);
                }
                const weatherData = await response.json();

                // 提取小时级别的间隔数据
                const hourlyIntervals = weatherData.hourly.data.timelines[0].intervals;

                // 调用渲染函数
                renderHourlyWeatherChart(hourlyIntervals);
            } catch (error) {
                console.error('加载或解析 JSON 数据时出错:', error);
            }
        }

        // 调用函数以加载数据并渲染图表
        loadAndRenderChart();
    </script>

</body>
</html>
