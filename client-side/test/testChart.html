<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Chart Test</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <h1>Weather Chart Test</h1>
    <div id="container"></div>

    <script>
        // 解析 JSON 数据并调用渲染图表函数
        function renderWeatherChart(hourlyData, container) {
            const temperatures = [];
            const humidity = [];
            const windSpeed = [];
            const pressure = [];
            const categories = [];
            const dates = [];

            // 遍历 JSON 数据中的时间序列，提取所需数据
            hourlyData.forEach((interval) => {
                const date = new Date(interval.startTime);
                const timeLabel = date.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });

                categories.push(timeLabel);

                if (timeLabel === '00:00') {
                    dates.push(date.toLocaleDateString('en-US', {
                        weekday: 'short',
                        month: 'short',
                        day: 'numeric'
                    }));
                }

                temperatures.push(interval.values.temperature);
                humidity.push(interval.values.humidity);
                windSpeed.push(interval.values.windSpeed);
                pressure.push(interval.values.pressureSeaLevel);
            });

            // 使用 Highcharts 渲染图表
            Highcharts.chart(container, {
                chart: {
                    scrollablePlotArea: { minWidth: 720 }
                },
                title: {
                    text: 'Hourly Weather Forecast (Next 5 Days)'
                },
                xAxis: [
                    {
                        categories, // 底部时间轴
                        tickInterval: 6, // 每 6 小时一个刻度
                        labels: {
                            formatter: function () {
                                const value = this.value;
                                return ['00:00', '06:00', '12:00', '18:00'].includes(value) ? value : '';
                            },
                            rotation: -45,
                            align: 'right'
                        },
                        title: { text: 'Time' },
                        crosshair: true
                    },
                    {
                        categories: dates, // 顶部日期轴
                        linkedTo: 0,
                        tickInterval: 1, // 每天显示一个日期
                        opposite: true,
                        labels: {
                            align: 'center',
                            style: { fontSize: '12px', fontWeight: 'bold' }
                        }
                    }
                ],
                yAxis: [
                    {
                        title: { text: 'Temperature (°F)' },
                        min: 0,
                        max: 105,
                        tickInterval: 7
                    },
                    {
                        title: { enabled: false },
                        labels: { enabled: false },
                        opposite: true
                    },
                    {
                        title: { enabled: false },
                        labels: { enabled: false },
                        opposite: true
                    },
                    {
                        title: { enabled: false },
                        labels: { format: '{value} hPa', style: { color: 'green' } },
                        tickInterval: 5,
                        opposite: true
                    }
                ],
                tooltip: {
                    shared: true,
                    valueDecimals: 2
                },
                series: [
                    {
                        name: 'Temperature',
                        type: 'line',
                        data: temperatures,
                        tooltip: { valueSuffix: ' °F' },
                        color: '#FF5733',
                        marker: { enabled: false }
                    },
                    {
                        name: 'Humidity',
                        type: 'column',
                        data: humidity,
                        tooltip: { valueSuffix: ' %' },
                        color: '#33B5E5',
                        pointWidth: 8
                    },
                    {
                        name: 'Wind Speed',
                        type: 'line',
                        data: windSpeed,
                        tooltip: { valueSuffix: ' mph' },
                        color: '#FFC107',
                        marker: { enabled: false }
                    },
                    {
                        name: 'Pressure',
                        type: 'line',
                        data: pressure,
                        tooltip: { valueSuffix: ' hPa' },
                        dashStyle: 'ShortDash',
                        color: '#8BC34A',
                        marker: { enabled: false }
                    }
                ]
            });
        }

        // 从 JSON 文件加载数据并调用渲染函数
        fetch('weatherData.json')
            .then(response => response.json())
            .then(data => {
                const hourlyData = data.hourly.data.timelines[0].intervals;
                renderWeatherChart(hourlyData, 'container');
            })
            .catch(error => console.error('Error loading data:', error));
    </script>
</body>
</html>
