<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hourly Weather Chart Test</title>
    <!-- 引入 Highcharts 库 -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <style>
        /* 可选：图表容器的样式 */
        #hourlyWeatherChart {
            width: 100%;
            height: 600px;
            margin: 0 auto;
        }
    </style>
</head>
<body>

    <!-- 图表容器 -->
    <div id="hourlyWeatherChart"></div>

    <script>
        /**
         * 渲染逐小时天气图表
         * @param {Array} hourlyData - 小时级别的天气数据数组
         */
        function renderHourlyWeatherChart(hourlyData) {
            // 确保 hourlyData 是一个数组
            if (!Array.isArray(hourlyData)) {
                console.error('hourlyData 应该是一个包含间隔数据的数组。');
                return;
            }

            const categories = hourlyData.map(data =>
                new Date(data.startTime).toLocaleTimeString('en-US', { 
                    hour: 'numeric', 
                    minute: 'numeric', 
                    hour12: true 
                })
            );

            const temperatures = hourlyData.map(data => data.values.temperature);
            const humidity = hourlyData.map(data => data.values.humidity);
            const windSpeed = hourlyData.map(data => data.values.windSpeed);
            const pressure = hourlyData.map(data => data.values.pressureSeaLevel);

            Highcharts.chart('hourlyWeatherChart', {
                chart: {
                    scrollablePlotArea: { minWidth: 600 }
                },
                title: {
                    text: 'Hourly Weather Forecast (Next 5 Days)'
                },
                xAxis: {
                    categories: categories,
                    tickInterval: 6, // 每 6 小时显示一个刻度
                    title: { text: 'Time' }
                },
                yAxis: [{ // 温度 Y 轴
                    title: { text: 'Temperature (°F)' },
                    min: 0, // 从 0°F 开始
                    max: 105,
                    tickInterval: 7, // 每 7°F 一个刻度
                    opposite: false
                }, { // 湿度 Y 轴
                    title: { enabled: false },
                    opposite: true,
                    labels: { enabled: false }
                }, { // 风速 Y 轴
                    title: { enabled: false },
                    opposite: true,
                    labels: { enabled: false }
                }, { // 气压 Y 轴
                    title: { text: 'Pressure (inHg)' },
                    opposite: true,
                    labels: {
                        format: '{value} inHg',
                        style: { color: 'green' }
                    },
                    tickInterval: 1, // 每 1 inHg 一个刻度
                    gridLineWidth: 0
                }],
                tooltip: {
                    shared: true,
                    valueDecimals: 2
                },
                series: [{
                    name: 'Temperature',
                    type: 'line',
                    data: temperatures,
                    tooltip: { valueSuffix: ' °F' },
                    color: '#FF5733',
                    dashStyle: 'Solid',
                    marker: { enabled: false },
                    zIndex: 3
                }, {
                    name: 'Humidity',
                    type: 'column',
                    data: humidity,
                    tooltip: { valueSuffix: ' %' },
                    yAxis: 1,
                    color: '#33B5E5',
                    pointWidth: 8,
                    zIndex: 1
                }, {
                    name: 'Wind Speed',
                    type: 'line',
                    data: windSpeed,
                    tooltip: { valueSuffix: ' mph' },
                    yAxis: 2,
                    color: '#FFC107',
                    dashStyle: 'Solid',
                    marker: { enabled: false },
                    zIndex: 2
                }, {
                    name: 'Pressure',
                    type: 'line',
                    data: pressure,
                    tooltip: { valueSuffix: ' inHg' },
                    yAxis: 3,
                    color: '#8BC34A',
                    dashStyle: 'ShortDash',
                    marker: { enabled: false },
                    zIndex: 2
                }]
            });
        }

        /**
         * 从 weatherData.json 加载数据并渲染图表
         */
        async function loadAndRenderChart() {
            try {
                const response = await fetch('weatherData.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! 状态: ${response.status}`);
                }
                const weatherData = await response.json();

                // 提取小时级别的间隔数据
                const hourlyIntervals = weatherData.hourly.data.timelines[0].intervals;

                // 调用渲染函数
                renderHourlyWeatherChart(hourlyIntervals);
            } catch (error) {
                console.error('加载或解析 JSON 数据时出错:', error);
            }
        }

        // 调用函数以加载数据并渲染图表
        loadAndRenderChart();
    </script>

</body>
</html>
